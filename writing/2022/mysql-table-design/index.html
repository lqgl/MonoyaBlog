<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=color-scheme content="dark light"><meta name=theme-color content="#54BAB9"><meta name=msapplication-TileColor content="#54BAB9"><meta name=description content="为什么一定要设一个主键？ #不管设置不设置主键，innodb 也会生成一个隐藏列，作为自增主键。所以啦，反正都要生成一个主键，那你还不如自己指定"><meta itemprop=name content="MySQL 表设计注意问题"><meta itemprop=description content="为什么一定要设一个主键？ #不管设置不设置主键，innodb 也会生成一个隐藏列，作为自增主键。所以啦，反正都要生成一个主键，那你还不如自己指定"><meta itemprop=datePublished content="2022-09-29T14:08:37+08:00"><meta itemprop=dateModified content="2022-09-29T14:08:37+08:00"><meta itemprop=wordCount content="1363"><meta itemprop=image content="https://lqgl.cool/apple-touch-icon.png"><meta itemprop=keywords content="Database,MySQL,"><meta property="og:title" content="MySQL 表设计注意问题"><meta property="og:description" content="为什么一定要设一个主键？ #不管设置不设置主键，innodb 也会生成一个隐藏列，作为自增主键。所以啦，反正都要生成一个主键，那你还不如自己指定"><meta property="og:type" content="article"><meta property="og:url" content="https://lqgl.cool/writing/2022/mysql-table-design/"><meta property="og:image" content="https://lqgl.cool/apple-touch-icon.png"><meta property="article:section" content="writing"><meta property="article:published_time" content="2022-09-29T14:08:37+08:00"><meta property="article:modified_time" content="2022-09-29T14:08:37+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lqgl.cool/apple-touch-icon.png"><meta name=twitter:title content="MySQL 表设计注意问题"><meta name=twitter:description content="为什么一定要设一个主键？ #不管设置不设置主键，innodb 也会生成一个隐藏列，作为自增主键。所以啦，反正都要生成一个主键，那你还不如自己指定"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#54bab9><link rel="shortcut icon" href=/favicon.ico><title>MySQL 表设计注意问题</title><link rel=dns-prefetch href=//cdn.jsdelivr.net><link rel=stylesheet href=https://lqgl.cool/css/style.min.7cf192d60a2f0f4422ad86d96853ba8ff16c2f7ae673d20e432e6e488e021055.css integrity="sha256-fPGS1govD0QirYbZaFO6j/FsL3rmc9IOQy5uSI4CEFU="></head><body><div id=page><header id=site-header><div id=site-branding><a href=https://lqgl.cool>Kami's Planet</a></div><nav id=site-nav><a href=/writing>Writing</a>
<a href=/gallery>Gallery</a>
<a href=/link>Link</a>
<a href=/about>About</a></nav></header><main id=site-main class=wrapper><article><header class=post-header><div class=title-area><a id=home-btn title="Kami's Planet" href=https://lqgl.cool><img src=/apple-touch-icon.png width=180 height=180 alt=Logo></a><div class=title-area-l><div id=post-header-date>Sep 29, 2022</div><h1 id=page-title>MySQL 表设计注意问题</h1></div></div><button id=toc-btn title=目录><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3" y2="6"/><line x1="3" y1="12" x2="3" y2="12"/><line x1="3" y1="18" x2="3" y2="18"/></svg> 目录</button></header><div id=toc class=sidebar><p class=toc-title>目录</p><nav id=TableOfContents><ul><li><a href=#为什么一定要设一个主键>为什么一定要设一个主键？</a></li><li><a href=#主键是用自增还是-uuid>主键是用自增还是 UUID?</a></li><li><a href=#自增主键用完后怎么办>自增主键用完后怎么办？</a></li><li><a href=#主键为什么不推荐有业务含义>主键为什么不推荐有业务含义？</a></li><li><a href=#表示枚举的字段为什么不用-enum-类型>表示枚举的字段为什么不用 enum 类型？</a></li><li><a href=#货币字段用什么类型>货币字段用什么类型？</a></li><li><a href=#时间字段用什么类型>时间字段用什么类型？</a></li><li><a href=#为什么不直接存储图片音频视频等大容量内容>为什么不直接存储图片、音频、视频等大容量内容？</a></li><li><a href=#字段为什么要定义为-not-null>字段为什么要定义为 NOT NULL?</a></li></ul></nav></div><div class=content><h2 id=为什么一定要设一个主键>为什么一定要设一个主键？ <a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%80%e5%ae%9a%e8%a6%81%e8%ae%be%e4%b8%80%e4%b8%aa%e4%b8%bb%e9%94%ae class=anchor aria-hidden=true><span class=anchor-icon>#</span></a></h2><p>不管设置不设置主键，innodb 也会生成一个隐藏列，作为自增主键。所以啦，反正都要生成一个主键，那你还不如自己指定一个主键，在有些情况下，就能显式的用上主键索引，提高查询效率！</p><h2 id=主键是用自增还是-uuid>主键是用自增还是 UUID? <a href=#%e4%b8%bb%e9%94%ae%e6%98%af%e7%94%a8%e8%87%aa%e5%a2%9e%e8%bf%98%e6%98%af-uuid class=anchor aria-hidden=true><span class=anchor-icon>#</span></a></h2><p>自增。数据在物理结构上是顺序存储，性能最好。</p><h2 id=自增主键用完后怎么办>自增主键用完后怎么办？ <a href=#%e8%87%aa%e5%a2%9e%e4%b8%bb%e9%94%ae%e7%94%a8%e5%ae%8c%e5%90%8e%e6%80%8e%e4%b9%88%e5%8a%9e class=anchor aria-hidden=true><span class=anchor-icon>#</span></a></h2><p>把自增主键改成 bigint 类型就好了。不过一般 int 类型用不到最大值，就分表分库了。</p><h2 id=主键为什么不推荐有业务含义>主键为什么不推荐有业务含义？ <a href=#%e4%b8%bb%e9%94%ae%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%8d%e6%8e%a8%e8%8d%90%e6%9c%89%e4%b8%9a%e5%8a%a1%e5%90%ab%e4%b9%89 class=anchor aria-hidden=true><span class=anchor-icon>#</span></a></h2><ol><li><p>因为任何有业务含义的列都有改变的可能性，主键一旦带上了业务含义，那么主键就有可能发生变更。主键一旦发生变更，该数据在磁盘上的存储位置就会发生变更，有可能会引发页分裂，产生空间碎片。</p></li><li><p>带有业务含义的主键，不一定是顺序自增的。那么就会导致数据的插入顺序，并不能保证后面插入数据的主键一定比前面的数据大。如果出现了，后面插入数据的主键比前面的小，就有可能引发页分裂，产生空间碎片。</p></li></ol><h2 id=表示枚举的字段为什么不用-enum-类型>表示枚举的字段为什么不用 enum 类型？ <a href=#%e8%a1%a8%e7%a4%ba%e6%9e%9a%e4%b8%be%e7%9a%84%e5%ad%97%e6%ae%b5%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%8d%e7%94%a8-enum-%e7%b1%bb%e5%9e%8b class=anchor aria-hidden=true><span class=anchor-icon>#</span></a></h2><ol><li><p>ENUM 类型的 ORDER BY 操作效率低，需要额外操作</p></li><li><p>如果枚举值是数值，有陷阱</p></li></ol><h2 id=货币字段用什么类型>货币字段用什么类型？ <a href=#%e8%b4%a7%e5%b8%81%e5%ad%97%e6%ae%b5%e7%94%a8%e4%bb%80%e4%b9%88%e7%b1%bb%e5%9e%8b class=anchor aria-hidden=true><span class=anchor-icon>#</span></a></h2><p>如果货币单位是分，可以用 Int 类型。如果坚持用元，用 Decimal [ˈdes (ə) məl]。
千万不要答 float 和 double，因为 float 和 double 是以二进制存储的，所以有一定的误差。</p><h2 id=时间字段用什么类型>时间字段用什么类型？ <a href=#%e6%97%b6%e9%97%b4%e5%ad%97%e6%ae%b5%e7%94%a8%e4%bb%80%e4%b9%88%e7%b1%bb%e5%9e%8b class=anchor aria-hidden=true><span class=anchor-icon>#</span></a></h2><ol><li><p>varchar，如果用 varchar 类型来存时间，优点在于显示直观。但是坑的地方也是挺多的。比如，插入的数据没有校验，你可能某天就发现一条数据为 2013111 的数据，请问这是代表 2013 年 1 月 11 日，还是 2013 年 11 月 1 日？
其次，做时间比较运算，你需要用 STR_TO_DATE 等函数将其转化为时间类型，你会发现这么写是无法命中索引的。数据量一大，是个坑！</p></li><li><p>timestamp，该类型是四个字节的整数，它能表示的时间范围为 1970-01-01 08:00:01 到 2038-01-19 11:14:07。2038 年以后的时间，是无法用 timestamp 类型存储的。
但是它有一个优势，timestamp 类型是带有时区信息的。一旦你系统中的时区发生改变，例如你修改了时区 SET TIME_ZONE = &ldquo;america/new_york&rdquo;;
你会发现，项目中的该字段的值自己会发生变更。这个特性用来做一些国际化大项目，跨时区的应用时，特别注意！</p></li><li><p>datetime，datetime 储存占用 8 个字节，它存储的时间范围为 1000-01-01 00:00:00 ~ 9999-12-31 23:59:59。显然，存储时间范围更大。但是它坑的地方在于，他存储的是时间绝对值，不带有时区信息。如果你改变数据库的时区，该项的值不会自己发生变更！</p></li><li><p>bigint，也是 8 个字节，自己维护一个时间戳，表示范围比 timestamp 大多了，就是要自己维护，不大方便。</p></li></ol><h2 id=为什么不直接存储图片音频视频等大容量内容>为什么不直接存储图片、音频、视频等大容量内容？ <a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%8d%e7%9b%b4%e6%8e%a5%e5%ad%98%e5%82%a8%e5%9b%be%e7%89%87%e9%9f%b3%e9%a2%91%e8%a7%86%e9%a2%91%e7%ad%89%e5%a4%a7%e5%ae%b9%e9%87%8f%e5%86%85%e5%ae%b9 class=anchor aria-hidden=true><span class=anchor-icon>#</span></a></h2><p>我们在实际应用中，都是用 HDFS 来存储文件。然后 mysql 中，只存文件的存放路径。mysql 中有两个字段类型被用来设计存放大容量文件，也就是 text 和 blob 类型。但是，我们在生产中，基本不用这两个类型！</p><ol><li><p>Mysql 内存临时表不支持 TEXT、BLOB 这样的大数据类型，如果查询中包含这样的数据，在排序等操作时，就不能使用内存临时表，必须使用磁盘临时表进行。导致查询效率缓慢</p></li><li><p>binlog 内容太多。因为你数据内容比较大，就会造成 binlog 内容比较多。大家也知道，主从同步是靠 binlog 进行同步，binlog 太大了，就会导致主从同步效率问题！</p></li></ol><h2 id=字段为什么要定义为-not-null>字段为什么要定义为 NOT NULL? <a href=#%e5%ad%97%e6%ae%b5%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e5%ae%9a%e4%b9%89%e4%b8%ba-not-null class=anchor aria-hidden=true><span class=anchor-icon>#</span></a></h2><ol><li><p>索引性能不好</p></li><li><p>查询会出现一些不可预料的结果</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>table_2</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>name</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>表 table_2 数据是这样的:</p><table><thead><tr><th>id</th><th>name</th></tr></thead><tbody><tr><td>1</td><td>王二</td></tr><tr><td>3</td><td></td></tr><tr><td>5</td><td>麻子</td></tr><tr><td>7</td><td></td></tr></tbody></table><p>你执行语句</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>table_2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>会发现结果为 2，但是实际上是有四条数据的！</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://lqgl.cool/tags/database>Database</a></span><span class=tag><a href=https://lqgl.cool/tags/mysql>MySQL</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1363 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2022-09-29 06:08</p></footer></article><div class=post-nav><a class=next-post href=https://lqgl.cool/writing/2022/network-tcp/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>TCP 协议</span></a>
<a class=prev-post href=https://lqgl.cool/writing/2022/mysql/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>MySQL</span></a></div><button type=button id=scroll-top-btn title=回到顶部><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up-circle"><circle cx="12" cy="12" r="10"/><polyline points="16 12 12 8 8 12"/><line x1="12" y1="16" x2="12" y2="8"/></svg></button>
<script src=https://giscus.app/client.js data-repo=lqgl/blog data-repo-id="MDEwOlJlcG9zaXRvcnk0MDc1ODU3NjY=" data-category=Announcements data-category-id=DIC_kwDOGEtD5s4CRp8B data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></main><footer id=site-footer class=wrapper><div class=footer-inner><div class=footer-l><nav class=site-nav><a href=https://lqgl.cool>Home</a><span>/</span><a href=/writing>Writing</a><span>/</span><a href=/gallery>Gallery</a><span>/</span><a href=/link>Link</a><span>/</span><a href=/about>About</a><span>/</span></nav></div><div class=footer-r><p class=site-copy>&copy; 2023 <a href=https://lqgl.cool>Kami</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/deed.zh target=_blank rel=noopener>CC BY-NC 4.0</a> &#183; <a href=https://lqgl.cool/writing/index.xml target=_blank title=RSS class=icon-link><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></div></div></footer><div class=sakana-box></div><script src=https://cdn.jsdelivr.net/npm/sakana></script>
<script>Sakana.init({el:".sakana-box",character:"chisato",inertia:.01,decay:.99,r:60,y:10,scale:.4,translateY:0,canSwitchCharacter:!1})</script></div><canvas class=fireworks style=position:fixed;left:0;top:0;z-index:1;pointer-events:none></canvas>
<script type=text/javascript src=/js/anime.min.js></script>
<script type=text/javascript src=/js/firework.js></script><div id=bg-img></div><script src=https://lqgl.cool/js/main.min.07b236541121fc0dbaaa229353e79a5f42e02811b753c6ed2093899c5bac59d2.js integrity="sha256-B7I2VBEh/A26qiKTU+eaX0LgKBG3U8btIJOJnFusWdI="></script>
<script src=/js/instant.page-5.1.1.js type=module integrity=sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq></script></body></html>