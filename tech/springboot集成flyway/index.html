<!doctype html><html lang=zh-hans><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#fcfcfc"><meta name=msapplication-TileColor content="#fcfcfc"><meta itemprop=name content="Springboot集成FlyWay"><meta itemprop=description content="Springboot集成FlyWay，使用FlyWay进行数据库版本管理"><meta itemprop=datePublished content="2020-12-24T00:00:00+00:00"><meta itemprop=dateModified content="2020-12-24T00:00:00+00:00"><meta itemprop=wordCount content="811"><meta itemprop=keywords content="SpringBoot,FlyWay,"><meta property="og:title" content="Springboot集成FlyWay"><meta property="og:description" content="Springboot集成FlyWay，使用FlyWay进行数据库版本管理"><meta property="og:type" content="article"><meta property="og:url" content="https://lqgl.cool/tech/springboot%E9%9B%86%E6%88%90flyway/"><meta property="article:section" content="tech"><meta property="article:published_time" content="2020-12-24T00:00:00+00:00"><meta property="article:modified_time" content="2020-12-24T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Springboot集成FlyWay"><meta name=twitter:description content="Springboot集成FlyWay，使用FlyWay进行数据库版本管理"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Springboot集成FlyWay</title><link rel=stylesheet href=https://lqgl.cool/css/style.min.67017a7027c7c05e8e18eb14b38cc24eb9d8c65ce69d53db9e9432c2d580749d.css integrity="sha256-ZwF6cCfHwF6OGOsUs4zCTrnYxlzmnVPbnpQywtWAdJ0=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://lqgl.cool>Lqgl's Blog</a></div><nav class="site-nav hide-in-mobile"><a href=https://lqgl.cool/life/>Life</a>
<a href=https://lqgl.cool/tech/>Tech</a>
<a href=https://lqgl.cool/about-me/>About</a>
<a href=https://lqgl.cool/about-friends/>Friend Links</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/ target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://instagram.com/ target=_blank rel="noopener me" title=Instagram><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/></svg></a><a href=https://github.com/lqgl target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://lqgl.cool/life/>Life</a></li><li><a href=https://lqgl.cool/tech/>Tech</a></li><li><a href=https://lqgl.cool/about-me/>About</a></li><li><a href=https://lqgl.cool/about-friends/>Friend Links</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Dec 24, 2020</span></div><h1>Springboot集成FlyWay</h1></header><div class=content><h2 id=依赖>依赖<a href=#依赖 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>在pom.xml添加maven依赖</p><pre tabindex=0><code>&lt;!-- mysql 依赖 --&gt;
&lt;dependency&gt;
&lt;groupId&gt;mysql&lt;/groupId&gt;
&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- 数据库版本管理 依赖 --&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.flywaydb&lt;/groupId&gt;
&lt;artifactId&gt;flyway-core&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- 数据库访问依赖 --&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><pre tabindex=0><code>&lt;plugin&gt;
    &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;
    &lt;artifactId&gt;flyway-maven-plugin&lt;/artifactId&gt;
&lt;/plugin&gt;
</code></pre><h2 id=配置-applicationyml>配置 <code>application.yml</code><a href=#配置-applicationyml class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>在application.ym文件添加Flyway配置
需要先配置数据源（连接上数据库），可以自己换成druid</p><pre tabindex=0><code># 数据源
spring:
  datasource:
    url: jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;allowMultiQueries=true&amp;serverTimezone=PRC&amp;useSSL=false
    username: root
    password: 密码
    # MySQL 8.x以下: com.mysql.jdbc.Driver
    driver-class-name: com.mysql.cj.jdbc.Driver
---
# FLYWAY (FlywayProperties)
spring:
  flyway:
    url: jdbc:mysql://127.0.0.1:3306/test?serverTimezone=UTC
    user: root
    password: 密码
    baseline-on-migrate: true #在没有元数据表的情况下，针对非空Schema执行迁移时是否自动调用基线。
</code></pre><h3 id=在resource目录下创建dbmigration目录添加sql脚本>在resource目录下创建db/migration目录添加sql脚本<a href=#在resource目录下创建dbmigration目录添加sql脚本 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p><img src=https://raw.githubusercontent.com/lqgl/repo/main/img/20201224132145.png alt>
手动创建 db/migration 目录，然后在该目录下创建数据库脚本，数据库脚本的命名方式如下：</p><pre tabindex=0><code>V&lt;VERSION&gt;__&lt;NAME&gt;.sql #注意：是两条下划线
#比如V1_0_0__Create_Table_User.sql
</code></pre><p>首先是大写字母 V，然后是版本号，要是有小版本可以用下划线隔开，例如 2_1，版本号后面是<code>两个下划线</code>，然后是脚本名称，文件后缀是 <code>.sql</code>。</p><h3 id=验证是否成功>验证是否成功:<a href=#验证是否成功 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>项目启动时,会运行flyway执行sql语句.生成schema_version表,用于记录sql执行情况.
去数据库<code>test</code>看<code>flyway_schema_history</code>表
<img src=https://raw.githubusercontent.com/lqgl/repo/main/img/20201224132524.png alt></p><h2 id=其他配置>其他配置<a href=#其他配置 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><pre tabindex=0><code>spring:
  flyway:
    enabled: true #是否开启 flyway，默认就是开启的
    url: jdbc:mysql://127.0.0.1:3306/mygame?serverTimezone=UTC # 地址
    user: root #用户名
    password: 365472 #密码
    baseline-on-migrate: true #在没有元数据表的情况下，针对非空Schema执行迁移时是否自动调用基线。
    encoding: UTF-8 #flyway 字符编码
    locations: classpath:db/migration #sql 脚本的目录，默认是 classpath:db/migration，如果有多个，用 , 隔开
    clean-disabled: true #这个属性非常关键，它表示是否要清除已有库下的表，如果执行的脚本是 V1__xxx.sql，那么会先清除已有库下的表，然后再执行脚本，这在开发环境下还挺方便，但是在生产环境下就要命了，而且它默认就是要清除，生产环境一定要自己配置设置为 true。
    table: flyway_schema_history #配置数据库信息表的名称，默认是 flyway_schema_history。
</code></pre><h2 id=参考文档>参考文档<a href=#参考文档 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p><a href=https://blog.csdn.net/qq_41402200/article/details/89247317>SpringBoot整合Flyway</a>
<a href="https://baijiahao.baidu.com/s?id=1659024978275677262&wfr=spider&for=pc">简化Spring Boot项目部署，Flyway搞起来</a></p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://lqgl.cool/tags/springboot>SpringBoot</a></span><span class=tag><a href=https://lqgl.cool/tags/flyway>FlyWay</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>811 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-12-24 00:00</p></footer></article><div class="post-nav thin"><a class=next-post href=https://lqgl.cool/tech/springboot%E9%9B%86%E6%88%90swagger3/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>SpringBoot集成Swagger3.0.0</span></a>
<a class=prev-post href=https://lqgl.cool/tech/%E5%9C%A8%E9%98%BF%E9%87%8C%E4%BA%91ubuntu%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E5%AE%89%E8%A3%85mysql/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>在阿里云Ubuntu服务器上安装Mysql</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2022 <a href=https://lqgl.cool>Lqgl</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://lqgl.cool/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://lqgl.cool/js/bundle.min.580988ed2982bcbb74a1773c7abea97b43e4c43b9324e10cda0813ec6ec4bb67.js integrity="sha256-WAmI7SmCvLt0oXc8er6pe0PkxDuTJOEM2ggT7G7Eu2c=" crossorigin=anonymous></script></body><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?50c3f3ef571621033fd843f7a435fa32",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></html>